/*
 Ajax.JS
 @author	Tom Flidr | tomflidr(at)gmail(dot)com
 @url		https://github.com/tomFlidr/ajax.js
 @licence	https://tomflidr.github.io/ajax.js/LICENSE.md
 @version	1.0.15
 @date	2024-10-29
 @example

    var xhr = Ajax.load(<Ajax.cfg.Load>{
       url: 'https://tomflidr.github.io/ajax.js/books.json',
       method: 'POST', // GET|POST|OPTION|HEAD...
       data: { anything: ["to", "serialize"] },
       success: (data?: any, statusCode?: number, xhr?: XMLHttpRequest|null, requestId?: number, url?: string, type?: string) => {},
       type: 'json', // json|jsonp|xml|html|text
       error: (responseText?: string, statusCode?: number, xhr?: XMLHttpRequest|null, errorObj?: Error|null, errorEvent?: Event|null, requestId?: number, url?: string, type?: string) => {},
       headers: {},
       cache: false,
       async: true
    });

*/
(function(C,J){if(typeof window!=C)var p=window;else p=typeof global!=C?global:{},J=!0;p=p.Ajax=p.Ajax||function(l,D,A,E,v,q,r,t,u,K,L,w,M,N,F,G,H,O,P,Q,B,R,x,S,I,y,T,U,V,W){function e(){}e[r]={before:[],success:[],abort:[],error:[]};e[V]={"X-Requested-With":"XmlHttpRequest","Content-Type":"application/x-www-form-urlencoded"};e[K]="callback";e[L]="_";e.aa="JsonpCallback";e.J=0;e.beforeLoad=function(a){e[r][M].push(a);return e};e.onSuccess=function(a){e[r][E].push(a);return e};e.onAbort=function(a){e[r][N].push(a);
return e};e.onError=function(a){e[r][v].push(a);return e};e[y]=function(){var a=new e;return a.v.apply(a,[].slice.apply(arguments)).A()};e[I]=function(){var a=new e;return a.v.apply(a,[].slice.apply(arguments)).A(I)};e.load=function(a){return(new e).v(a.url,a.data,a[E],a.type,a[v],a.headers,a.cache,a[B]).A(a.method)};e[W]={toString:function(){return"[object Ajax]"},v:function(a,b,d,c,f,g,h,k){function m(){}this.url=a||"";this.data=b||{};this.b=d||m;this.type=null!=c?c[x]():S;this.error=f||m;this.headers=
g||{};this.cache=null==h?!1:h;this.async=null==k?!0:k;this.result={b:!1,data:{}};this.f=this.c=null;return this},A:function(a){this.g=!!D.all;return this.type==t?this.S():this.T(a).a},S:function(){var a=this,b=D.createElement("script"),d=a.N();a.h=b;a.requestId=e.J++;a.m=e.aa+a.requestId;e[a.m]=function(c){a.P(c)};a.F(y,!0);b[R]("src",a.url);a.C();a.g?(b[Q]("on"+A,a.s()),b=d.insertAdjacentElement("beforeEnd",b)):(b[R](B,B),b[P](v,a.s(),!0),b=d.appendChild(b));return{url:a.url,id:a.requestId,abort:function(){a.u();
a.B()}}},P:function(a){var b=this,d=!1;b.result.b=!0;b.u();b.result.data=a;try{b.b(a,200,null,b.requestId,b.url,b.type),d=!0,b.l()}catch(c){throw d||setTimeout(function(){b.l()}),c;}},s:function(){var a=this,b=a.h;return a.g?function(d){d=d||window.event;"loaded"!=b.readyState||a.result.b||a.G(d)}:function(d){a.G(d)}},G:function(a){var b=this,d=!1,c=b.s();b.g?b.h.detachEvent("on"+A,c):b.h.removeEventListener(v,c,!0);b.u();b.c=a;b.H();try{b.error("",0,null,null,a,b.requestId,b.url,b.type),d=!0,b.i()}catch(f){throw d||
setTimeout(function(){b.i()}),f;}},u:function(){this.h.parentNode.removeChild(this.h);this.g?e[this.m]=void 0:delete e[this.m]},T:function(a){a=(null==a?y:a)[x]();var b=this.F(a,!1);this.requestId=e.J++;this.a=this.K();this.U();this.a.open(a,this.url,this.async);this.ba();this.C();this.V(a,b);return this},U:function(){function a(c){4==d.readyState&&b.R(c)}var b=this,d=b.a;if(b.g)b.a[Q]("on"+A,a);else b.a[P](A,a)},R:function(a){a=a||window.event;var b=this.a[u];199<b&&300>b?(this.W(),this.I()):0===
b?this.B():(this.result.b=!1,this.c=a,this.f=Error("Http Status Code: "+b),this.I())},V:function(a,b){var d=this.a;if(a===y)d[T]();else if(a===I)d[T](b)},I:function(){var a=this,b=a.a,d=!1,c=[];if(a.result.b){c=[a.result.data,b[u],b,a.requestId,a.url,a.type];try{a.b.apply(null,c),d=!0,a.l()}catch(f){throw d||setTimeout(function(){a.l()}),f;}}else{c=[b[q],b[u],b,a.c,a.f,a.requestId,a.url,a.type];a.H();try{a.error.apply(null,c),d=!0,a.i()}catch(f){throw d||setTimeout(function(){a.i()}),f;}}},W:function(){this.type===
S&&this.Y();this.X()},X:function(){var a=this.a;this.type===F?this.Z():this.type===G||this.type===H?this.$():this.type===O&&(this.result.data=a[q],this.result.b=!0)},Y:function(){var a=this.O();this.type=O;-1<a.indexOf("javascript")||-1<a.indexOf(F)?this.type=F:-1<a.indexOf(H)?this.type=H:-1<a.indexOf(G)&&(this.type=G)},Z:function(){var a=this.a[q];l[w]||this.o();try{this.result.data=l[w][U](a),this.result.b=!0}catch(b){try{this.result.data=(new Function("return "+a))(),this.result.b=!0}catch(d){}this.f=
b}},$:function(){var a={},b=this.a[q],d=l.DOMParser;try{d?(a=new d,this.result.data=a.parseFromString(b,"application/xml")):(a=new l.ActiveXObject("Microsoft.XMLDOM"),a[B]=!1,this.result.data=a.loadXML(b)),this.result.b=!0}catch(c){this.f=c}},O:function(){var a=this.L(),b=a.indexOf("/");-1<b&&(a=a.substr(b+1));return a},L:function(){var a=this.a.getResponseHeader("Content-Type"),b=a.indexOf(";");a=0<a.length?a[x]():"";-1<b&&(a=a.substr(0,b));return a},K:function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0",
"Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(l.XMLHttpRequest)var b=new l.XMLHttpRequest;else for(var d=0,c=a.length;d<c;d+=1)try{b=new l.ActiveXObject(a[d])}catch(f){}return b},ba:function(){var a=this.a,b=this.headers,d=e[V],c;for(c in b)a.setRequestHeader(c,b[c]);for(c in d)b[c]||a.setRequestHeader(c,d[c])},F:function(a,b){var d="?",c=this.url,f=c.indexOf(d);-1<f&&(d=f===c.length-1?"":"&");a=a[x]();a===y?(a=this.D(!0),c+=d+a,d="&",a=""):a=this.D(!1);this.cache||(c+=d+e[L]+"="+ +new Date);b&&(c+=d+
e[K]+"="+this.M()+"."+this.m);this.url=c;return a},D:function(a){var b=this.data,d=!!l[w];if("string"==typeof b)if(a)d||(d=this.o()),this.data=l[w][U](b);else return b;d||this.o();return this.ca(a)},ca:function(){var a=this.data,b=[],d=l[w],c=l.encodeURIComponent,f;for(f in a){var g=a[f];if(null==g)b.push(f+"=");else{var h=this.da(g);if("Object"==h)h=c(d.stringify(g)),b.push(f+"="+h);else if("Array"==h)for(var k=0,m=g.length;k<m;k++)h=c(d.stringify(g[k])),b.push(f+"[]="+h);else h=c(String(g)),b.push(f+
"="+h)}}return b.join("&")},da:function(a){a=Object[W].toString.apply(a);return a.substring(8,a.length-1)},o:function(){window.JSON=function(){function a(c){return 10>c?"0"+c:c}function b(c,f){var g;var h=/["\\\x00-\x1f\x7f-\x9f]/g;var k;switch(typeof c){case "string":return h.test(c)?'"'+c.replace(h,function(X){var z=d[X];if(z)return z;z=X.charCodeAt();return"\\u00"+Math.floor(z/16).toString(16)+(z%16).toString(16)})+'"':'"'+c+'"';case "number":return isFinite(c)?String(c):"null";case "boolean":case "null":return String(c);
case "object":if(!c)return"null";if("function"===typeof c.toJSON)return b(c.toJSON());h=[];if("number"===typeof c.length&&!c.propertyIsEnumerable("length")){var m=c.length;for(g=0;g<m;g+=1)h.push(b(c[g],f)||"null");return"["+h.join(",")+"]"}if(f)for(m=f.length,g=0;g<m;g+=1){var n=f[g];"string"===typeof n&&(k=b(c[n],f))&&h.push(b(n)+":"+k)}else for(n in c)"string"===typeof n&&(k=b(c[n],f))&&h.push(b(n)+":"+k);return"{"+h.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+
"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var d={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(c,f){function g(h,k){var m;if(k&&"object"===typeof k)for(m in k)if(Object.prototype.hasOwnProperty.apply(k,[m])){var n=g(m,k[m]);void 0!==n&&(k[m]=n)}return f(h,k)}if(/^[\],:{}\s]*$/.test(c.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return c=eval("("+c+")"),"function"===typeof f?g("",c):c;throw new SyntaxError("parseJSON");}}}();return!0},N:function(){for(var a=D.body;null!=a.previousSibling&&(a=a.previousSibling,"head"!==a.nodeName[x]()););return a},C:function(){this.j(M,this.type===t?[null]:[this.a])},l:function(){var a=this.a,b=this.result.data;this.j(E,this.type===t?[b,200,null]:[b,a[u],a])},B:function(){this.j(N,this.type===t?[null]:[this.a])},i:function(){var a=this.a;this.j(v,this.type===
t?["",0,null,null,this.c]:[a[q],a[u],a,this.ea,null])},j:function(a,b){function d(){}a=e[r][a];b.push(this.requestId,this.url,this.type);for(var c=0,f=a.length;c<f;c+=1)d=a[c],"function"==typeof d&&d.apply(null,b)},H:function(){var a=this.requestId,b=this.url,d=this.type,c=this.f,f=this.c,g=this.a;l.console&&(d===t?l.console.log(a,b,d,0,f):l.console.log(a,b,d,g,g[u],g[q],c,c.stack))},M:function(){var a=this.toString();return a.substr(8,a.length-9)}};return e}(p,document,"readystatechange","success",
"error","responseText","handlers","jsonp","status","jsonpCallbackParam","cacheBusterParamName","JSON","before","abort","json","xml","html","text","addEventListener","attachEvent","async","setAttribute","toLowerCase","auto","post","get","send","parse","defaultHeaders","prototype");J&&typeof module!=C&&(module.exports=p)})("undefined",!1);
